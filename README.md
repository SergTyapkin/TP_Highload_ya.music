# Архитектура высоконагруженного веб-сервиса
----------------
## Yandex.music
Яндекс.Музыка - популярный сервис по прослушиванию музыки

## MVP
* Раздача аудиофайлов
* Загрузка музыки исполнителями

## [Аудитория](https://radar.yandex.ru/yandex?month=2021-08)
* Месячная: 10 701 402
* Дневная: 2 043 505
* Среднее время за месяц: 2 ч 34 м
* Среднее время за день: 2 ч 34 м / 30 д = 5,13 м
* Процент мобильных пользователей: 48 %
* Кол-во зарегистрированных пользователей: [>3 млн.](https://vc.ru/media/96460-chislo-podpischikov-yandeks-muzyki-vyroslo-v-tri-raza-za-poltora-goda-i-dostiglo-3-mln)

Яндекс.Музыка - приложение для российского рынка, как и остальные проекты яндекса.
Целевая аудитория - преимущественно, люди до 45 лет, ведь именно они - основные потребители музыки вцелом.

### [Возрастное распределение аудитории](https://webindex.mediascope.net/report/sex-and-age?byDevice=3&byDevice=1&byDevice=2&byGeo=1&byMonth=202106&id=447221)
12 - 24  | 25 - 34  | 35 - 44  | 45 - 54  |   55 +   |
---------| ---------| ---------| ---------| ---------|
14,25 %  | 28,40 %  | 28,00 %  | 14,43 %  | 14,24 %  |

----------------
# Расчёт нагрузки
* Час музыки весит: [115 МБ](https://yandex.ru/support/music-app-android/offline/save-music.html)
    * минута музыки: 115 / 60 = 1,92 МБ
#### Трафик на раздачу:
Будем исходить из того, что пиковая нагрузка в 2,5 раза больше средней. Обуславливается тем, что вечером большинство людей возвращается с работы/учёбы и нагрузка на сеть повышается.
* За день: 5,13 мин. * 2 043 505 польз. = 10 483 180,65 мин/д = 20 127 706,85 МБ/д = 153,56 Тб/д.
* За секунду: 153,56 Тб/д = 1 908 404 б/сек = 1,82 Гб/сек.

Сессия состоит из:
* Получение главной страницы - списка плейлистов, подкастов, чартов. Таких списков на ней 6. В каждом в среднем по 4 элемента. Для каждого элемента нужно ещё получить картинку размером ~20 кБайт.
* Для браузерных пользователей - html страница. ~2Мб. ~30 запросов на сервер со статикой.
* Нажатие на кнопку "Моя волна" - получение списка аудио: 20 * ~26кБ = 520кБ.
* 
* Прослушивание аудиозаписи - получение всех её данных, включая обложку. Около 50кб. Притом за 5 минут онлайна прослушивает пользователь всего 1,5 трека. 
> Пусть каждый пользователь, слушая 10 треков, ищет поиском 3 из них, а добавляет к себе лишь 1.
> Тогда 1 трек = 1 + 0,3 + 0,1 = 1,4 запроса.


> Пусть средний пользователь слушает по 10 треков в день.

* Запросов за день (RPD): 10 треков * 1,4 запр/трек * 2 043 505 польз. = 28 609 070 запросов/д.
* Запросов в секунду (RPS): 28 609 070 / 86 400 = 332 запросов / сек.
* Пиковый RPS: 332 * 2,5 = 828 запросов / сек.


#### Трафик на загрузку:
* За минуту загружается: ~20мин музыки. Это обусловлено тем, что на Яндекс.Музыку не может загрузить трек любой желающий, лишь подтверждённые музыканты.
    * бит/сек: 20 * 1,92 = 38,4 МБ/мин. = 5 242,88 б/сек. = 5,12 Мб/сек.

> Средняя длительность трека: 3 мин.

* Запросов в день (RPD): (20 / 3) треков/мин * 60 * 24 = 9 600 запросов/день
* Запросов в секунду (RPS): 9 600 / 86 400 = 0,1 (не значительно)

## Сводная таблица (RPS, RPD)
   ______  | RPD        | RPS  | Пиковый RPS |
-----------| -----------| -----| ------------|
Раздача    | 28 609 070 | 332  | 828         |
Загрузка   | 9 600      | 0,1  | 0,25        |
Всего      | 28 618 670 | 333  | 829         |

